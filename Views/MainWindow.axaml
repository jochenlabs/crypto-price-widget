<Window xmlns="https://github.com/avaloniaui"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:vm="using:CryptoPriceWidget.ViewModels"
        x:Class="CryptoPriceWidget.Views.MainWindow"
        x:DataType="vm:MainViewModel"
        Title="Crypto Prices"
        SizeToContent="Width"
        MinWidth="400"
        Height="64"
        MinHeight="64"
        MaxHeight="64"
        CanResize="False"
        SystemDecorations="BorderOnly"
        Background="#202020"
        TransparencyLevelHint="AcrylicBlur"
        ExtendClientAreaToDecorationsHint="True"
        ExtendClientAreaChromeHints="NoChrome"
        WindowStartupLocation="Manual"
        Topmost="True">

  <!-- ── Tile templates ────────────────────────────────────── -->
  <Window.Resources>

    <!-- Horizontal tile: glyph / stacked symbol–price–timestamp + vertical divider -->
    <DataTemplate x:Key="HorizontalTileTemplate" x:DataType="vm:CoinTileViewModel">
      <StackPanel Orientation="Horizontal" Spacing="5" VerticalAlignment="Center">
        <TextBlock Text="{Binding Glyph}"
                   Foreground="{Binding AccentBrush}"
                   FontSize="14" FontWeight="Bold"
                   VerticalAlignment="Center" />
        <StackPanel Orientation="Vertical" Spacing="0" VerticalAlignment="Center">
          <TextBlock Text="{Binding Symbol}" Classes="coin-symbol" />
          <TextBlock Text="{Binding Price}"  Classes="coin-price" />
          <StackPanel Orientation="Horizontal" Spacing="3" VerticalAlignment="Center">
            <Ellipse Width="5" Height="5" Fill="{Binding SyncDotColor}" VerticalAlignment="Center" />
            <TextBlock Text="{Binding LastUpdatedText}" Foreground="#3DFFFFFF" FontSize="9" VerticalAlignment="Center" />
          </StackPanel>
        </StackPanel>
        <Rectangle Classes="divider" />
      </StackPanel>
    </DataTemplate>

    <!-- Vertical tile: same as horizontal but stacked, horizontal separator instead of vertical -->
    <DataTemplate x:Key="VerticalTileTemplate" x:DataType="vm:CoinTileViewModel">
      <StackPanel Orientation="Vertical" Margin="0">
        <StackPanel Orientation="Horizontal" Spacing="5" VerticalAlignment="Center" Margin="6 4">
          <TextBlock Text="{Binding Glyph}"
                     Foreground="{Binding AccentBrush}"
                     FontSize="14" FontWeight="Bold"
                     VerticalAlignment="Center" />
          <StackPanel Orientation="Vertical" Spacing="0" VerticalAlignment="Center">
            <TextBlock Text="{Binding Symbol}" Classes="coin-symbol" />
            <TextBlock Text="{Binding Price}"  Classes="coin-price" />
            <StackPanel Orientation="Horizontal" Spacing="3" VerticalAlignment="Center">
              <Ellipse Width="5" Height="5" Fill="{Binding SyncDotColor}" VerticalAlignment="Center" />
              <TextBlock Text="{Binding LastUpdatedText}" Foreground="#3DFFFFFF" FontSize="9" VerticalAlignment="Center" />
            </StackPanel>
          </StackPanel>
        </StackPanel>
        <Rectangle Height="1" Fill="#33FFFFFF" />
      </StackPanel>
    </DataTemplate>

  </Window.Resources>

  <Window.Styles>
    <Style Selector="TextBlock.coin-symbol">
      <Setter Property="Foreground" Value="#888888" />
      <Setter Property="FontSize"   Value="11" />
    </Style>
    <Style Selector="TextBlock.coin-price">
      <Setter Property="Foreground" Value="#FFFFFF" />
      <Setter Property="FontSize"   Value="15" />
      <Setter Property="FontWeight" Value="Bold" />
    </Style>
    <Style Selector="Rectangle.divider">
      <Setter Property="Width"   Value="1" />
      <Setter Property="Fill"    Value="#33FFFFFF" />
      <Setter Property="Margin"  Value="8 8" />
    </Style>
    <Style Selector="Button.icon">
      <Setter Property="Background"           Value="Transparent" />
      <Setter Property="BorderThickness"      Value="0" />
      <Setter Property="Padding"              Value="0" />
      <Setter Property="HorizontalContentAlignment" Value="Center" />
      <Setter Property="VerticalContentAlignment"   Value="Center" />
      <Setter Property="CornerRadius"         Value="6" />
    </Style>
  </Window.Styles>

  <Panel>
    <!-- Acrylic background -->
    <ExperimentalAcrylicBorder IsHitTestVisible="False">
      <ExperimentalAcrylicBorder.Material>
        <ExperimentalAcrylicMaterial
          BackgroundSource="Digger"
          TintColor="#202020"
          TintOpacity="0.92"
          MaterialOpacity="0.98" />
      </ExperimentalAcrylicBorder.Material>
    </ExperimentalAcrylicBorder>

    <!-- Pill border -->
    <Border BorderThickness="0">
    
      <!-- Full-area drag surface -->
      <Border Background="#202020" PointerPressed="DragRegion_PointerPressed">

        <DockPanel Margin="10 0" LastChildFill="True">

          <!-- Right: Add / Pin / Close buttons -->
          <StackPanel x:Name="ButtonsPanel" DockPanel.Dock="Right" Orientation="Horizontal" Spacing="2" VerticalAlignment="Center">


            <Button x:Name="RefreshButton"
                    Classes="icon"
                    Width="26" Height="26"
                    Foreground="#AAAAAA"
                    FontSize="13"
                    ToolTip.Tip="Force refresh"
                    Click="Refresh_Click">
              <TextBlock Text="↻" FontSize="13" />
            </Button>
            <Button Classes="icon"
                    Width="26" Height="26"
                    Foreground="#AAAAAA"
                    FontSize="14"
                    ToolTip.Tip="Manage coins"
                    Click="ManageCoins_Click">
              <TextBlock Text="⚙" FontSize="14" />
            </Button>

            <Button Classes="icon"
                    Width="26" Height="26"
                    Foreground="#888888"
                    FontSize="12"
                    Click="CloseButton_Click">
              <TextBlock Text="✕" FontSize="12" />
            </Button>

          </StackPanel>

          <!-- Center: dynamic coin tiles + status -->
          <StackPanel Orientation="Horizontal"
                      VerticalAlignment="Center"
                      Spacing="0">

            <!-- Dynamic coin tiles -->
            <ItemsControl x:Name="CoinItemsControl"
                          ItemsSource="{Binding Coins}"
                          ItemTemplate="{StaticResource HorizontalTileTemplate}">
              <ItemsControl.ItemsPanel>
                <ItemsPanelTemplate>
                  <StackPanel Orientation="Horizontal" />
                </ItemsPanelTemplate>
              </ItemsControl.ItemsPanel>
            </ItemsControl>


          </StackPanel>

        </DockPanel>
      </Border>
    </Border>
  </Panel>

</Window>
